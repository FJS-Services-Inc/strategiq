{% if messages %}
<section class="section"
         id="status-container"
         role="region"
         aria-label="Analysis Progress"
         aria-live="polite">
    <div class="container"
         style="max-width: 800px;">
        <div class="status-timeline"
             role="feed"
             aria-label="Status updates">
            {% for message in messages %}
            {% set is_error = message.startswith('Error:') %}
            {% set is_loading = loop.last and not result %}
            {% set is_tool_message = message.startswith('Using tool') %}
            {% set is_complete = "complete" in message.lower() or "done" in message.lower() %}
            {% set status_label = 'Error' if is_error else ('Complete' if is_complete else ('In Progress' if is_loading else ('Processing' if is_tool_message else 'Status'))) %}

            <article class="status-item {% if is_error %}status-item--error{% elif is_complete %}status-item--success{% elif is_loading %}status-item--loading{% else %}status-item--info{% endif %}"
                     role="article"
                     aria-label="{{ status_label }}: {{ message }}">
                <div class="status-item__indicator"
                     aria-hidden="true">
                    {% if is_error %}
                    <i class="fas fa-circle-xmark"></i>
                    {% elif is_complete %}
                    <i class="fas fa-circle-check"></i>
                    {% elif is_loading %}
                    <i class="fas fa-circle-notch fa-spin"></i>
                    {% else %}
                    <i class="fas fa-circle"></i>
                    {% endif %}
                </div>
                <div class="status-item__content">
                    <div class="status-item__header">
                        {{ status_label }}
                    </div>
                    <div class="status-item__message">
                        {{ message }}
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}